<html>

<head>
    <title>React Fetch Data</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@latest/babel.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/react-bootstrap@next/dist/react-bootstrap.min.js" async
        crossorigin></script>


    <script>var Alert = ReactBootstrap.Alert;</script>
</head>

<body>
    <h1>Mt Vernon Bulletins</h1>
    <p>Each week the worship bulletin is published in PDF format.</p>
    <div id="root"></div>
    <script type="text/babel">
        const { Container, Row, Col } = ReactBootstrap;

        // A single item in the list
        function Item({ item }) {
            const url = item.name.split('/').pop();

            return (
                <Row>
                    <Col>
                        <a href={url}>{
                            item.name
                                .replace(/-Bulletin-Mt.*non(-UMC)?/, "")
                                .replace(".pdf", "")}</a>
                    </Col>
                </Row>
            );
        }

        // Filter the data to only include .md and .pdf files
        // Puts the .md files first
        function itemList(data) {
            const pdfs = data.filter(item => item.path.endsWith('.pdf'))
                .sort((b, a) => a.path.localeCompare(b.path));
            return [
                ...data.filter(item => item.path.endsWith('.md')),
                ...pdfs
            ]
        }

        // Add label attribute to the data
        function addLabel(data) {
            return data.map(item => {
                const label = item.name.replace(/-Mt.*UMC/, "");
                return { ...item, label };
            });
        }

        function App() {
            const [data, setData] = React.useState([]);

            React.useEffect(() => {
                // Using the github API, get all of the entries
                // in https://pastor-robert/mtv/bulletins
                fetch('https://api.github.com/repos/pastor-robert/mtv/contents/bulletin')
                    .then(response => response.json())
                    .then(data => setData(data));
            }, []);

            return (
                <Container>
                    {itemList(data).map(item => <Item item={item} />)}
                </Container>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>

</html>